| id    | Title | Status      | Author  | Description | Discussions to | Created    |
| ----- | ----- | ----------- | ------- | ----------- | -------------- | ---------- |
| TIP-135 | Staking contract changes | Draft | GorstakThales | Changing how rewards for staking are distributed on Optimism | [discordlink ](https://discord.gg/thales)   | 2023-04-14 |

## Simple Summary

This TIP proposes to change the ratio between BASE and GAMIFIED staking rewards

## Abstract

Currently stakers on Optimism are weekly receiving 90k THALES, 60K is used for BASE rewards awarding all stakers, and 30k is used for GAMIFIED rewards awarding stakers who are active on Thales protocol.
This means that the ratio is 2:1 for BASE rewards, favoring idle stakers.
From those 30k allocated to GAMIFIED staking, 21k(70%) are allocated for Protocol Usage(Thales AMM trading, Vaults, Liquidity providing, Overtime trading) and 9k(30%) for SNX stakers.
To max out the protocol usage bucket a user needs to have at least 2 sUSD traded per 1 THALES received in last 4 weeks, which was very easy to do especially with introducing Vaults and LP.

## Motivation

We want to motivate traders to trade as much as possible without having the goal to just reach the max rewards for gamified staking.

## Specification

This TIP proposes to change the ratio between BASE and GAMIFIED to be 1:1, 45k THALES for BASE and 45k for GAMIFIED staking.

Additionally the TIP proposes to remove caps for maxing out rewards and introduce volume base distribution.
GAMIFIED staking will be distributed in next manner:

-   50% will go to traders on both Thalesmarkets and Overtime based on trader score in that week(Trading Module)
-   25% will go to Vaults and LP providers based on volume percentage for that week(Risk Module)
-   25% will go to SNX stakers(SNX module)

Trader score will be calculated by next formula:

`TraderScore = THALES_STAKED^(1-K) \* VOLUME_GENERATED^K`

Where K is a configurable variable that is deciding the weight of Thales staked for trader score.
Proposed initial value for K would be 0.7(0.3 for THALES_STAKED).

## Test Cases

Thales staking contract has 3 users:

-   USER_1_STAKED = 100 Thales
-   USER_2_STAKED = 200 Thales
-   USER_3_STAKED = 300 Thales

Staking contract has a TOTAL_STAKED of 100 + 200 + 300 = 600Thales staked.
BASE_REWARDS per week are 45k Thales.

BASE rewards distribution for users:

-   USER_1_BASE = BASE_REWARDS * USER_1_STAKED/TOTAL_STAKED = 45k * 100 / 600 = 7500 Thales
-   USER_2_BASE = BASE_REWARDS * USER_2_STAKED/TOTAL_STAKED = 45k * 200 / 600 = 15000 Thales
-   USER_3_BASE = BASE_REWARDS\* USER_3_STAKED/TOTAL_STAKED = 45k * 300 / 600 = 22500 Thales

GAMIFIED rewards are separated in three modules, Trading module, Risk(Vaults and LP) module and SNX module.
For Trader module we need also volume generated by users. As this is a new addition lets define several cases:

### TEST CASE 1(TRADING MODULE)

-   USER_1_VOLUME = 100$
-   USER_2_VOLUME = 200$
-   USER_3_VOLUME = 300$

We first need to calculate TraderScore for each user by formula `TraderScore = THALES_STAKED^(1-K) \* VOLUME_GENERATED^K`.

-   TRADER_SCORE_USER_1 = USER_1_STAKED^0.3 * USER_1_VOLUME^0.7 = 100^0.3 * 100^0.7 = 100
-   TRADER_SCORE_USER_2 = USER_2_STAKED^0.3 * USER_2_VOLUME^0.7 = 200^0.3 * 200^0.7 = 200
-   TRADER_SCORE_USER_3 = USER_3_STAKED^0.3 * USER_3_VOLUME^0.7 = 300^0.3 * 300^0.7 = 300

Now that we got trader score for each user we need to sum it up and get each users percentage of the global score. /b

GLOBAL_TRADERS_SCORE = TRADER_SCORE_USER_1 + TRADER_SCORE_USER_2 + TRADER_SCORE_USER_3 = 100 + 200 + 300 = 600

-   USER_1_PERCENTAGE = TRADER_SCORE_USER_1 / GLOBAL_TRADERS_SCORE = 100/600 = 0.167
-   USER_2_PERCENTAGE = TRADER_SCORE_USER_2 / GLOBAL_TRADERS_SCORE = 200/600 = 0.333
-   USER_3_PERCENTAGE = TRADER_SCORE_USER_3 / GLOBAL_TRADERS_SCORE = 300/600 = 0.5

Now we can calculate the alocation for each user for Trader Module. Total Thales allocated for Trader Module is 50% of 45k which is 22.5K Thales.

-   USER_1_ALLOCATION = USER_1_PERCENTAGE * 22.5K = 3750Thales
-   USER_2_ALLOCATION = USER_2_PERCENTAGE * 22.5K = 7500Thales
-   USER_3_ALLOCATION = USER_3_PERCENTAGE * 22.5K = 11250Thales

### TEST CASE 2(TRADING MODULE)

-   USER_1_VOLUME = 300$
-   USER_2_VOLUME = 200$
-   USER_3_VOLUME = 100$

We first need to calculate TraderScore for each user by formula `TraderScore = THALES_STAKED^(1-K) \* VOLUME_GENERATED^K`.

-   TRADER_SCORE_USER_1 = USER_1_STAKED^0.3 * USER_1_VOLUME^0.7 = 100^0.3 * 300^0.7 = 215.77
-   TRADER_SCORE_USER_2 = USER_2_STAKED^0.3 * USER_2_VOLUME^0.7 = 200^0.3 * 200^0.7 = 200
-   TRADER_SCORE_USER_3 = USER_3_STAKED^0.3 * USER_3_VOLUME^0.7 = 300^0.3 * 100^0.7 = 139.04

Now that we got trader score for each user we need to sum it up and get each users percentage of the global score. /b

GLOBAL_TRADERS_SCORE = TRADER_SCORE_USER_1 + TRADER_SCORE_USER_2 + TRADER_SCORE_USER_3 = 215.77 + 200 + 139.04 = 554.81

-   USER_1_PERCENTAGE = TRADER_SCORE_USER_1 / GLOBAL_TRADERS_SCORE = 215.77/554.81 = 0.389
-   USER_2_PERCENTAGE = TRADER_SCORE_USER_2 / GLOBAL_TRADERS_SCORE = 200/554.81 = 0.36
-   USER_3_PERCENTAGE = TRADER_SCORE_USER_3 / GLOBAL_TRADERS_SCORE = 139.04/554.81 = 0.251

Now we can calculate the alocation for each user for Trader Module. Total Thales allocated for Trader Module is 50% of 45k which is 22.5K Thales.

-   USER_1_ALLOCATION = USER_1_PERCENTAGE * 22.5K = 8752Thales
-   USER_2_ALLOCATION = USER_2_PERCENTAGE * 22.5K = 8100Thales
-   USER_3_ALLOCATION = USER_3_PERCENTAGE * 22.5K = 5648Thales

### TEST CASE 3(TRADING MODULE)

-   USER_1_VOLUME = 300$
-   USER_2_VOLUME = 100$
-   USER_3_VOLUME = 200$

We first need to calculate TraderScore for each user by formula `TraderScore = THALES_STAKED^(1-K) \* VOLUME_GENERATED^K`.

-   TRADER_SCORE_USER_1 = USER_1_STAKED^0.3 * USER_1_VOLUME^0.7 = 100^0.3 * 300^0.7 = 215.77
-   TRADER_SCORE_USER_2 = USER_2_STAKED^0.3 * USER_2_VOLUME^0.7 = 200^0.3 * 100^0.7 = 123.114
-   TRADER_SCORE_USER_3 = USER_3_STAKED^0.3 * USER_3_VOLUME^0.7 = 300^0.3 * 200^0.7 = 225.87

Now that we got trader score for each user we need to sum it up and get each users percentage of the global score. /b

GLOBAL_TRADERS_SCORE = TRADER_SCORE_USER_1 + TRADER_SCORE_USER_2 + TRADER_SCORE_USER_3 = 215.77 + 123.114 +225.87 = 564.754

-   USER_1_PERCENTAGE = TRADER_SCORE_USER_1 / GLOBAL_TRADERS_SCORE = 215.77/564.754 = 0.382
-   USER_2_PERCENTAGE = TRADER_SCORE_USER_2 / GLOBAL_TRADERS_SCORE = 123.114/564.754 = 0.218
-   USER_3_PERCENTAGE = TRADER_SCORE_USER_3 / GLOBAL_TRADERS_SCORE = 225.87/564.754 = 0.4

Now we can calculate the alocation for each user for Trader Module. Total Thales allocated for Trader Module is 50% of 45k which is 22.5K Thales.

-   USER_1_ALLOCATION = USER_1_PERCENTAGE * 22.5K = 8595Thales
-   USER_2_ALLOCATION = USER_2_PERCENTAGE * 22.5K = 4905Thales
-   USER_3_ALLOCATION = USER_3_PERCENTAGE * 22.5K = 9000Thales

## Implementation
TBD
## Copyright

Copyright and related rights waived via CC0.
